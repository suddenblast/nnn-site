---
import "../styles/theme.css";
import "../styles/global.css";

const { title = "NNN" } = Astro.props;

// Active nav
const path = Astro.url.pathname;
const isActive = (href: string) => (href === "/" ? path === "/" : path.startsWith(href));

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/stories", label: "Stories" },
  { href: "/shows", label: "Shows" },
  { href: "/team", label: "Our Team" },
];
const navLinksWithState = navLinks.map((link) => ({
  ...link,
  active: isActive(link.href),
}));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
<link rel="icon" href="/favicon.ico" sizes="any" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />

    <slot name="head" />
  </head>

  <body>
    <a class="skip-link" href="#main-content">Skip to main content</a>
    <header class="topbar" id="header">
      <div class="container nav">
        <a class="brand" href="/" aria-label="Northwestern News Network">
          <picture>
            <!-- Desktop -->
            <source media="(min-width: 768px)" srcset="/logo-horizontal.svg" />
            <!-- Mobile fallback -->
            <img class="site-logo" src="/logo-stacked.svg" alt="Northwestern News Network" />
          </picture>
        </a>

        <!-- Desktop links -->
        <nav class="navlinks" aria-label="Primary">
          {navLinksWithState.map((link) => (
            <a
              href={link.href}
              class:list={[link.active && "active"]}
              aria-current={link.active ? "page" : undefined}
            >
              {link.label}
            </a>
          ))}
        </nav>

        <!-- Mobile hamburger -->
        <button
          class="hamburger"
          type="button"
          aria-label="Open menu"
          aria-controls="mobile-menu"
          aria-expanded="false"
          data-menu-button
        >
          <span class="hamburger-lines" aria-hidden="true"></span>
        </button>
      </div>

      <!-- Mobile drawer -->
      <div class="mobile-menu" id="mobile-menu" hidden data-mobile-menu>
        <div class="container mobile-menu-inner">
          <nav class="mobile-links" aria-label="Mobile Primary">
            {navLinksWithState.map((link) => (
              <a
                href={link.href}
                class:list={[link.active && "active"]}
                aria-current={link.active ? "page" : undefined}
              >
                {link.label}
              </a>
            ))}
          </nav>

          <div class="mobile-meta">
            <div class="mobile-kicker">Northwestern News Network</div>
            <div class="mobile-sub">Video-first student newsroom.</div>
          </div>
        </div>
      </div>
    </header>

    <main id="main-content" data-page>
      <div class="container">
        <slot />
      </div>
    </main>

    <footer class="footer" aria-label="Northwestern University footer" data-page>
      <div class="container">
        <div class="nu-footer-top">
          <div class="nu-footer-brand">
            <img
              class="nu-footer-logo"
              src="/northwestern-wordmark.svg"
              alt="Northwestern University"
              loading="lazy"
            />
            <div class="nu-footer-kicker">
              Medill School of Journalism, Media, Integrated Marketing Communications
            </div>
            <div class="nu-footer-address">1845 Sheridan Road · Evanston, IL 60208</div>
            <a class="nu-footer-phone" href="tel:8474915225">847-491-5225</a>
            <a class="nu-footer-site" href="https://www.medill.northwestern.edu/">medill.northwestern.edu</a>
          </div>

          <div class="nu-footer-links" aria-label="Medill quick links">
            <a href="https://www.medill.northwestern.edu/">Medill Home</a>
            <a href="https://www.medill.northwestern.edu/news-and-events/index.html">News & Events</a>
            <a href="https://www.medill.northwestern.edu/directory/index.html">Directory</a>
            <a href="https://www.medill.northwestern.edu/about/visit.html">Visit Medill</a>
            <a href="https://www.medill.northwestern.edu/give.html">Support Medill</a>
            <a href="https://www.medill.northwestern.edu/about/contact.html">Contact Medill</a>
          </div>
        </div>

        <div class="nu-footer-bottom">
          <span>© {new Date().getFullYear()} Northwestern University</span>
          <span>All Rights Reserved</span>
        </div>
      </div>
    </footer>

    <!-- Tiny vanilla JS menu controller -->
    <script is:inline>
      (() => {
        const btn = document.querySelector("[data-menu-button]");
        const menu = document.querySelector("[data-mobile-menu]");
        const header = document.getElementById("header");
        const page = document.querySelectorAll("[data-page]");
        if (!btn || !menu || !header) return;

        const setOpen = (open) => {
          btn.setAttribute("aria-expanded", String(open));
          btn.setAttribute("aria-label", open ? "Close menu" : "Open menu");
          menu.hidden = !open;
          document.documentElement.classList.toggle("menu-open", open);
          document.documentElement.style.overflow = open ? "hidden" : "";
          page.forEach((el) => {
            if ("inert" in el) {
              el.inert = open;
            } else if (open) {
              el.setAttribute("aria-hidden", "true");
            } else {
              el.removeAttribute("aria-hidden");
            }
          });
          if (open) {
            const firstLink = menu.querySelector("a");
            if (firstLink) firstLink.focus();
          } else {
            btn.focus();
          }
        };

        const updateHeader = () => {
          header.classList.toggle("scrolled", window.scrollY > 50);
        };

        btn.addEventListener("click", () => {
          const open = btn.getAttribute("aria-expanded") === "true";
          setOpen(!open);
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") setOpen(false);
        });

        menu.addEventListener("click", (e) => {
          if (e.target && e.target.closest && e.target.closest("a")) setOpen(false);
        });

        window.addEventListener("scroll", updateHeader, { passive: true });
        setOpen(false);
        updateHeader();
      })();
    </script>
  </body>
</html>
